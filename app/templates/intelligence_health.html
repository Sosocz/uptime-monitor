{% extends "base.html" %}
{% block title %}Health Scores{% endblock %}
{% block page_title %}Health Scores{% endblock %}
{% block content %}
<div class="space-y-8 fade-in">
    <div>
        <h1 style="font-size:28px;font-weight:700;color:#1a1a1a;margin-bottom:8px;">Monitor Health Scores</h1>
        <p style="color:#6b7280;">Each monitor gets a health grade from A+ to D based on uptime, response time, and incident patterns</p>
    </div>

    <div id="monitors" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:20px;"></div>
    <div id="noMonitors" class="card" style="text-align:center;padding:48px;display:none;">
        <p style="color:#6b7280;">No monitors found. Add monitors to see health scores.</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
(function() {
    var token = localStorage.getItem('token');
    if (!token) window.location.href = '/login';

    fetchWithAuth('/api/monitors').then(r => r ? r.json() : []).then(function(monitors) {
        if (!monitors || monitors.length === 0) {
            document.getElementById('noMonitors').style.display = 'block';
            return;
        }

        var container = document.getElementById('monitors');
        var promises = monitors.map(function(m) {
            return fetchWithAuth('/api/intelligence/monitors/' + m.id + '/health')
                .then(r => r ? r.json() : null)
                .then(health => ({ monitor: m, health: health }));
        });

        Promise.all(promises).then(function(results) {
            container.innerHTML = results.map(function({monitor, health}) {
                if (!health) return '';
                var gradeColor = {A: '#10b981', B: '#3b82f6', C: '#f59e0b', D: '#ef4444'}[health.grade[0]] || '#6b7280';
                return '<div class="card">' +
                    '<div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;">' +
                    '<div><h3 style="font-size:16px;font-weight:600;color:#1a1a1a;">' + monitor.name + '</h3>' +
                    '<p style="color:#6b7280;font-size:13px;">' + monitor.url + '</p></div>' +
                    '<div style="font-size:32px;font-weight:800;color:' + gradeColor + ';">' + health.grade + '</div>' +
                    '</div>' +
                    '<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;font-size:13px;">' +
                    '<div><div style="color:#6b7280;">Health Score</div><div style="font-weight:600;">' + health.score.toFixed(1) + '%</div></div>' +
                    '<div><div style="color:#6b7280;">Uptime</div><div style="font-weight:600;">' + (health.uptime_percentage || 0).toFixed(2) + '%</div></div>' +
                    '</div></div>';
            }).join('');
        });
    });
})();
</script>
{% endblock %}
