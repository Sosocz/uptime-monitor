{% extends "base.html" %}
{% block title %}Revenue Tracking{% endblock %}
{% block page_title %}Revenue Tracking{% endblock %}
{% block content %}
<div id="upgradePrompt" class="card" style="text-align:center;padding:60px;">
    <div style="font-size:64px;margin-bottom:24px;">ðŸ’°</div>
    <h1 style="font-size:32px;font-weight:700;color:#1a1a1a;margin-bottom:16px;">FonctionnalitÃ© PRO</h1>
    <p style="color:#6b7280;font-size:18px;margin-bottom:32px;max-width:500px;margin-left:auto;margin-right:auto;">
        Le Revenue Tracking est une fonctionnalitÃ© PRO. Calculez le coÃ»t financier rÃ©el des incidents et le temps perdu.
    </p>
    <div style="background:linear-gradient(135deg,#1e1b4b 0%,#312e81 100%);border-radius:12px;padding:32px;margin-bottom:32px;">
        <h2 style="font-size:24px;font-weight:700;color:#fff;margin-bottom:16px;">DÃ©bloquez Revenue Tracking PRO</h2>
        <ul style="list-style:none;padding:0;margin-bottom:24px;color:#fff;text-align:left;">
            <li style="margin-bottom:12px;">âœ“ CoÃ»t financier en temps rÃ©el</li>
            <li style="margin-bottom:12px;">âœ“ Temps perdu par incident</li>
            <li style="margin-bottom:12px;">âœ“ Historique des pertes</li>
            <li style="margin-bottom:12px;">âœ“ ROI du monitoring</li>
            <li>âœ“ Export des donnÃ©es</li>
        </ul>
        <a href="/upgrade" class="btn" style="background:#fff;color:#1e1b4b;font-weight:700;text-decoration:none;padding:16px 32px;border-radius:8px;display:inline-block;">
            Upgrade to PRO - â‚¬19/mois
        </a>
    </div>
</div>

<div id="revenueContent" class="space-y-8 fade-in" style="display:none;">
    <div>
        <h1 style="font-size:28px;font-weight:700;color:#1a1a1a;margin-bottom:8px;">Revenue Tracking</h1>
        <p style="color:#6b7280;">Track money lost during incidents and see the financial impact of downtime</p>
    </div>

    <div id="monitors" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:20px;"></div>
    <div id="noMonitors" class="card" style="text-align:center;padding:48px;display:none;">
        <p style="color:#6b7280;">No monitors found. Add monitors to see revenue tracking.</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
(function() {
    var token = localStorage.getItem('token');
    if (!token) window.location.href = '/login';
    
    // Check user plan and show upgrade prompt if FREE
    fetchWithAuth('/api/settings/me').then(function(r) {
        if (!r) return;
        return r.json();
    }).then(function(user) {
        if (!user) return;
        
        var isFree = user.plan === 'FREE';
        var upgradePrompt = document.getElementById('upgradePrompt');
        var revenueContent = document.getElementById('revenueContent');
        
        if (isFree) {
            upgradePrompt.style.display = 'block';
            revenueContent.style.display = 'none';
        } else {
            upgradePrompt.style.display = 'none';
            revenueContent.style.display = 'block';
            
            // Load revenue data (only for PRO)
            fetchWithAuth('/api/monitors').then(r => r ? r.json() : []).then(function(monitors) {
                if (!monitors || monitors.length === 0) {
                    document.getElementById('noMonitors').style.display = 'block';
                    return;
                } 
        
                var container = document.getElementById('monitors');
                container.innerHTML = monitors.map(function(m) {
                    var lostTime = m.total_minutes_lost || 0;
                    var lostMoney = m.total_money_lost || 0;
                    
                    return '<div class="card">' +
                        '<div style="margin-bottom:16px;">' +
                        '<h3 style="font-size:16px;font-weight:600;color:#1a1a1a;margin-bottom:4px;">' + m.name + '</h3>' +
                        '<p style="color:#6b7280;font-size:13px;">' + m.url + '</p>' +
                        '</div>' +
                        '<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;padding-top:16px;border-top:1px solid #e5e7eb;">' +
                        '<div><div style="color:#6b7280;font-size:12px;">Temps perdu</div>' +
                        '<div style="font-size:18px;font-weight:700;color:#ef4444;">' + lostTime + ' min</div></div>' +
                        '<div><div style="color:#6b7280;font-size:12px;">Argent perdu</div>' +
                        '<div style="font-size:18px;font-weight:700;color:#ef4444;">' + lostMoney.toFixed(2) + 'â‚¬</div></div>' +
                        '</div></div>';
                }).join('');
            });
        }
    });
})();
</script>
{% endblock %}
